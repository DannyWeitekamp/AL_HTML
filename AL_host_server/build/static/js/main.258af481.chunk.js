(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{117:function(e,t,n){var r=n(73),a=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(39)),o=a(n(53)),s=a(n(43)),l=a(n(44)),c=a(n(54)),u=a(n(55)),d=a(n(56)),f=a(n(75)),p=a(n(57)),_=r(n(1)),h=n(49),g=a(n(127)),m=n(128);function v(e,t,n){return e=[e],t.forEach(function(t,r){e=e.map(function(e,a){if("string"==typeof e){var i=e.split(t);if(i.length>1)return o=i,s=_.default.createElement(h.Text,{style:{color:n[r],textShadowRadius:3,textShadowColor:n[r]}},t),(0,p.default)(o).map(function(e,t){return t<o.length-1?[e,s]:[e]}).reduce(function(e,t){return e.concat(t)})}var o,s;return e}).flat()}),e}var b={ButtonPressed:function(e,t){return"Press Button"},UpdateTextField:function(e,t){return e.name||e.how}},y={UpdateTextField:function(e,t){var n=e.mapping["?sel"],r=Object.entries(e.mapping).reduce(function(e,t){return"?sel"!==t[0]&&e.push(t[1]),e},[]);n=n.replace("?ele-","");var a="("+(r=r.map(function(e){return e.replace("?ele-","")})).join(", ")+"): "+n+"->"+(e.inputs&&e.inputs.value);return a=v(a,[n].concat(r),t)},ButtonPressed:function(e,t){return"Press: "+e.mapping["?sel"].replace("?ele-","")}},k=function(e){function t(e){var n;(0,s.default)(this,t),(n=(0,c.default)(this,(0,u.default)(t).call(this,e))).s_skill_set=n.structure_skills(e.skill_set);var r=n.starting_selection();return n.state={selected_skill:r,selected_match:r,feedback_map:{},s_skill_set:{"":[]}},n.handleClickSkillItem=n.handleClickSkillItem.bind((0,f.default)((0,f.default)(n))),n.handleToggleFeedbackButton=n.handleToggleFeedbackButton.bind((0,f.default)((0,f.default)(n))),n}return(0,d.default)(t,e),(0,l.default)(t,[{key:"starting_selection",value:function(){if("first"==this.props.initial_select){var e=Object.keys(this.s_skill_set)[0];return null==e?null:this.s_skill_set[e][0]}}},{key:"structure_skills",value:function(e){var t={},n=0,r=function(){var r={};for(i in e[a])(o=e[a][i]).how in r||(r[o.how]=o,r[o.how].matches=[]),o._id=n++,r[o.how].matches.push(o),t[a]=Object.keys(r).map(function(e,t){return r[e]})};for(var a in e){var i,o;r()}return t}},{key:"selectSkill",value:function(e,t){t||(t=e),this.setState({selected_skill:e,selected_match:t})}},{key:"daisyChain",value:function(e,t,n){return function(r){e(r,t,n)}}},{key:"handleClickSkillItem",value:function(e,t,n){var r=(0,o.default)(t,2),a=r[0],i=r[1];this.selectSkill(a,i),this.props.select_callback&&this.props.interactions_service.send({type:"STAGE_SAI",data:i||a}),n&&n(t)}},{key:"handleToggleFeedbackButton",value:function(e,t){var n=(0,o.default)(t,3),r=n[0],a=n[1],i=n[2];this.props.interactions_service.send({type:"TOGGLE_FEEDBACK",skill:r,match:a,label:i})}},{key:"updateFeedbackMap",value:function(e){this.setState({feedback_map:e}),console.log(e)}},{key:"queuedSkillApplicationFeedback",value:function(){var e=(0,i.default)({},this.state.feedback_map);for(var t in e)e[t]="correct"===e[t]?1:-1;return e}},{key:"componentDidUpdate",value:function(e,t){if(!m(e.skill_set,this.props.skill_set)){var n=this.structure_skills(this.props.skill_set);this.setState({feedback_map:{},s_skill_set:n});var r=Object.keys(n);if(r.length>0){var a=n[r[0]][0];this.setState({selected_skill:a,selected_match:a})}else this.setState({selected_skill:null,selected_match:null})}}},{key:"render",value:function(){var e=this;return _.default.createElement(h.View,{style:S.content},_.default.createElement(h.View,{style:T.skill_list},_.default.createElement(h.ScrollView,null,Object.keys(this.state.s_skill_set).map(function(t,n){var r=_.default.createElement(h.TouchableHighlight,{underlayColor:"#fff"},_.default.createElement(h.Text,{style:T.sectionHeader},t)),a=e.state.s_skill_set[t].map(function(t,n){var r=e.state.selected_skill&&e.state.selected_skill._id===t._id,a=(b[t.action]||b.UpdateTextField)(t,e.props.where_colors),i=_.default.createElement(h.TouchableHighlight,{underlayColor:"#f1f1f1",onPress:e.daisyChain(e.handleClickSkillItem,[t],t.callback)},_.default.createElement(h.Text,{style:[T.item,r&&T.selected_skill],backgroundColor:"#ff00ffff"},a)),o=[];return"matches"in t&&(o=t.matches.map(function(n,a){if("mapping"in n){var i=e.state.selected_match&&e.state.selected_match._id===n._id,o=(y[n.action]||y.UpdateTextField)(n,e.props.where_colors),s="correct"===e.state.feedback_map[n._id],l="incorrect"===e.state.feedback_map[n._id];return _.default.createElement(h.View,{style:T.match_container},_.default.createElement(h.TouchableHighlight,{underlayColor:"#919191",onPress:e.daisyChain(e.handleToggleFeedbackButton,[t,n,"correct"])},_.default.createElement(h.Text,{style:[T.feedback_button,s&&T.correct_selected]},String.fromCharCode(10004))),_.default.createElement(h.TouchableHighlight,{underlayColor:"#919191",onPress:e.daisyChain(e.handleToggleFeedbackButton,[t,n,"incorrect"])},_.default.createElement(h.Text,{style:[T.feedback_button,l&&T.incorrect_selected]},String.fromCharCode(10006))),_.default.createElement(h.TouchableHighlight,{underlayColor:"#919191",style:{flex:1},onPress:e.daisyChain(e.handleClickSkillItem,[t,n],n.callback)},_.default.createElement(h.Text,{style:[T.match,r&&i&&T.selected_match]},o)))}return null})),o=o.filter(function(e){return null!=e}),[i].concat(o)});return[r].concat(a)}))),_.default.createElement(h.ScrollView,{style:T.skill_info,showsVerticalScrollIndicator:!0},_.default.createElement(g.default,{title:"How",collapsedHeight:this.props.collapsedHeight.how},_.default.createElement(h.Text,null,this.state.selected_skill&&this.state.selected_skill.how)),_.default.createElement(g.default,{title:"Where",collapsedHeight:this.props.collapsedHeight.where},_.default.createElement(h.Text,null,this.state.selected_skill&&JSON.stringify(this.state.selected_skill.where,null,2))),_.default.createElement(g.default,{title:"When",collapsedHeight:this.props.collapsedHeight.when},_.default.createElement(h.Text,null,this.state.selected_skill&&this.state.selected_skill.when)),_.default.createElement(g.default,{title:"Which",collapsedHeight:this.props.collapsedHeight.which},_.default.createElement(h.Text,null,this.state.selected_skill&&this.state.selected_skill.which))))}}]),t}(_.Component),S=h.StyleSheet.create({content:{flex:1,flexDirection:"row",backgroundColor:"#F5FCFF",borderRadius:4,borderWidth:.5,borderColor:"#d6d7da"}}),T=h.StyleSheet.create({skill_list:{flexBasis:250,paddingTop:10},skill_info:{flex:1,paddingTop:10},sectionHeader:{flexWrap:"wrap",paddingTop:6,paddingLeft:10,paddingRight:10,paddingBottom:2,fontSize:15,fontWeight:"bold",backgroundColor:"'rgba(247,247,247,1.0)'"},selected_skill:{backgroundColor:"#93e4ec"},item:{flexWrap:"wrap",padding:4,paddingLeft:6,fontSize:16,borderBottomWidth:1,borderColor:"gray",backgroundColor:"'rgba(247,0,0,0.0)'"},feedback_button:{fontSize:20,width:27,textAlign:"center",borderWidth:.1,borderColor:"lightgray"},incorrect_selected:{backgroundColor:"red"},correct_selected:{backgroundColor:"limegreen"},match_container:{display:"flex",flexDirection:"row",borderBottomWidth:1,borderColor:"gray"},match:{flex:1,flexWrap:"wrap",padding:3,textIndent:5,fontSize:15,backgroundColor:"'rgba(252,252,252,1.0)'"},selected_match:{backgroundColor:"#b3e8ff"}});k.defaultProps={collapsedHeight:{how:40,where:90,when:90,which:40},where_colors:["darkorchid","#ff884d","#52d0e0","#feb201","#e44161","#ed3eea","#2f85ee","#562ac6","#cc24cc"],select_callback:function(){}};var x=k;t.default=x},127:function(e,t,n){var r=n(73),a=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(43)),o=a(n(44)),s=a(n(54)),l=a(n(55)),c=a(n(56)),u=r(n(1)),d=n(49),f=function(e){function t(e){var r;return(0,i.default)(this,t),(r=(0,s.default)(this,(0,l.default)(t).call(this,e))).icons={up:n(231),down:n(232)},r.state={title:e.title,expanded:!1,expandable:!0,animation:new d.Animated.Value(e.collapsedHeight)},r}return(0,c.default)(t,e),(0,o.default)(t,[{key:"_setMaxHeight",value:function(e){this.setState({maxHeight:e.nativeEvent.layout.height,expandable:e.nativeEvent.layout.height>this.props.collapsedHeight})}},{key:"_setMinHeight",value:function(e){this.setState({minHeight:e.nativeEvent.layout.height})}},{key:"toggle",value:function(){var e=Math.max(this.state.maxHeight+this.state.minHeight,this.props.collapsedHeight),t=Math.max(this.state.minHeight,this.props.collapsedHeight),n=this.state.expanded?e:t,r=this.state.expanded?t:e;this.setState({expanded:!this.state.expanded}),this.state.animation.setValue(n),d.Animated.timing(this.state.animation,{toValue:r,duration:50}).start()}},{key:"render",value:function(){var e=this.icons.down;return this.state.expanded&&(e=this.icons.up),u.default.createElement(d.Animated.View,{style:[p.container,{height:this.state.animation}]},u.default.createElement(d.TouchableHighlight,{underlayColor:"#f1f1f1",onLayout:this._setMinHeight.bind(this),onPress:this.state.expandable?this.toggle.bind(this):null},u.default.createElement(d.View,{style:p.titleContainer},u.default.createElement(d.Text,{style:p.title}," ",this.props.title," "),this.state.expandable&&u.default.createElement(d.Image,{style:p.buttonImage,source:e}))),u.default.createElement(d.View,{style:p.body,onLayout:this._setMaxHeight.bind(this)},this.props.children))}}]),t}(u.Component),p=d.StyleSheet.create({container:{backgroundColor:"#fff",margin:2,overflow:"hidden"},titleContainer:{flexDirection:"row"},title:{flex:1,padding:2,color:"#2a2f43",fontWeight:"bold"},button:{},buttonImage:{width:30,height:25},body:{padding:5,paddingTop:0,paddingBottom:20}}),_=f;t.default=_},129:function(e,t,n){var r=n(73),a=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n(115)),o=a(n(43)),s=a(n(44)),l=a(n(54)),c=a(n(55)),u=a(n(56)),d=r(n(1)),f=n(49),p=(a(n(127)),n(128)),_=["Or specify if the ",d.default.createElement(f.Text,{style:{color:"darkorchid",textShadowRadius:3,textShadowColor:"darkorchid"}},"highlighted")," input is correct for the next step."],h=function(e){function t(e){return(0,o.default)(this,t),(0,l.default)(this,(0,c.default)(t).call(this,e))}return(0,u.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this,t=this.props.interactions_state,n=function(e){return t&&t.matches?t.matches(e):p(e,{Waiting_User_Feedback:"Waiting_Yes_No_Feedback"})};console.log("props",this.props);var r=function(t){console.log(t),console.log(e.props.callbacks),e.props.callbacks&&t in e.props.callbacks&&e.props.callbacks[t](),e.props.interactions_service.send(t)};return d.default.createElement(f.View,{style:g.container},d.default.createElement(f.View,{style:g.button_wrapper1},d.default.createElement(f.Text,{style:g.prompt1},n("Setting_Start_State")&&"Set the start state.",(n("Waiting_User_Feedback")||n({Waiting_User_Feedback:"Waiting_Yes_No_Feedback"}))&&"Demonstrate the next step.",n("Explantions_Displayed")&&"Press next to continue. Or demonstrate the next step.",n("Waiting_Select_Foci")&&"Select any interface elements that were used to compute this result.",n("Waiting_User_Attempt")&&"TUTOR MODE"),n("Waiting_Select_Foci")&&d.default.createElement(f.TouchableHighlight,{style:g.next_button,underlayColor:"#CCCCCC",onPress:function(){return r("FOCI_DONE")}},d.default.createElement(f.Text,{style:g.next_button_text},"Next")),n("Explantions_Displayed")&&d.default.createElement(f.TouchableHighlight,{style:g.next_button,underlayColor:"#CCCCCC",onPress:function(){return r("NEXT_PRESSED")}},d.default.createElement(f.Text,{style:g.next_button_text},"Next")),n("Setting_Start_State")&&d.default.createElement(f.TouchableHighlight,{style:g.startstate_button,underlayColor:"#CCCCCC",onPress:function(){return r("START_STATE_SET")}},d.default.createElement(f.Text,{style:g.startstate_button_text},"Start State Done"))),(n({Waiting_User_Feedback:"Waiting_Yes_No_Feedback"})||n({Waiting_User_Feedback:"Waiting_Submit_Feedback"}))&&d.default.createElement(f.View,{style:g.button_wrapper2},d.default.createElement(f.Text,{style:g.prompt2},n({Waiting_User_Feedback:"Waiting_Yes_No_Feedback"})&&_,n({Waiting_User_Feedback:"Waiting_Submit_Feedback"})&&"Or press submit to send the feedback from the skill panel."),n({Waiting_User_Feedback:"Waiting_Yes_No_Feedback"})&&d.default.createElement(f.View,{style:g.yes_no},d.default.createElement(f.TouchableHighlight,{style:g.yes_button,underlayColor:"#CCCCCC",onPress:function(){return r("YES_PRESSED")}},d.default.createElement(f.Text,{style:g.yes_button_text},"YES")),d.default.createElement(f.TouchableHighlight,{style:g.no_button,underlayColor:"#CCCCCC",onPress:function(){return r("NO_PRESSED")}},d.default.createElement(f.Text,{style:g.no_button_text},"NO"))),n({Waiting_User_Feedback:"Waiting_Submit_Feedback"})&&d.default.createElement(f.TouchableHighlight,{style:g.submit_button,underlayColor:"#CCCCCC",onPress:function(){return r("SUBMIT_SKILL_FEEDBACK")}},d.default.createElement(f.Text,{style:g.submit_button_text},"Submit"))),!this.props.debugmode&&d.default.createElement(f.View,{style:g.button_wrapper3},d.default.createElement(f.TouchableHighlight,{style:g.nools_button,underlayColor:"#CCCCCC",onPress:function(){return e.props.app.changeInteractionMode({tutor_mode:!e.props.tutor_mode})}},d.default.createElement(f.Text,{style:g.nools_button_text},this.props.tutor_mode?"Train Mode":"Tutor Mode")),d.default.createElement(f.TouchableHighlight,{style:g.nools_button,underlayColor:"#CCCCCC",onPress:function(){return e.props.app.generateBehaviorProfile()}},d.default.createElement(f.Text,{style:g.nools_button_text},"Gen bProfile"))),this.props.debugmode&&d.default.createElement(f.View,{style:g.button_wrapper3},d.default.createElement(f.View,{style:{display:"absolute",bottom:0,flexDirection:"row"}},d.default.createElement(f.TouchableHighlight,{style:[g.yes_button,{height:20}],underlayColor:"#CCCCCC",onPress:function(){return r("DEMONSTRATE")}},d.default.createElement(f.Text,{style:{fontSize:10}},"Demonstrate")),d.default.createElement(f.TouchableHighlight,(0,i.default)({style:[g.yes_button,{height:20}],underlayColor:"#CCCCCC",onPress:function(){}},"onPress",function(){return r("DONE")}),d.default.createElement(f.Text,{style:{fontSize:10}},"Done")),d.default.createElement(f.TouchableHighlight,(0,i.default)({style:[g.yes_button,{height:20}],underlayColor:"#CCCCCC",onPress:function(){}},"onPress",function(){return r("APPLICABLE_SKILLS_RECIEVED")}),d.default.createElement(f.Text,{style:{fontSize:10}},"Req recieved")))))}}]),t}(d.Component),g=f.StyleSheet.create({container:{flex:1,flexDirection:"column"},prompt1:{fontSize:20,textAlign:"center",margin:3,flexWrap:"wrap"},prompt2:{fontSize:20,textAlign:"center",margin:7,marginTop:25,marginBottom:12,flexWrap:"wrap"},button_wrapper1:{display:"flex",flexDirection:"column",alignItems:"center"},button_wrapper2:{display:"flex",flexDirection:"column",alignItems:"center",flexShrink:1},button_wrapper3:{display:"flex",flexDirection:"row",justifyContent:"space-around",padding:5,marginTop:"auto"},yes_no:{display:"flex",flexDirection:"row"},nools_button:{padding:5,width:100,backgroundColor:"#999999",borderRadius:5},nools_button_text:{textAlign:"center"},startstate_button:{position:"relative",width:200,backgroundColor:"#4CAF50",borderRadius:5,padding:5},startstate_button_text:{fontSize:20,textAlign:"center"},yes_button:{width:80,backgroundColor:"#4CAF50",borderRadius:6,margin:8,padding:4},yes_button_text:{fontSize:30,textAlign:"center"},no_button:{width:80,backgroundColor:"#f44336",borderRadius:6,margin:8,padding:4},no_button_text:{fontSize:30,textAlign:"center"},next_button:{width:100,backgroundColor:"#4CAFFF",borderRadius:6,margin:10,padding:5},next_button_text:{fontSize:35,textAlign:"center"},submit_button:{width:150,backgroundColor:"#4CAFFF",borderRadius:6,margin:10,padding:5},submit_button_text:{fontSize:30,textAlign:"center"},prompt_text:{textAlign:"center",fontSize:25}}),m=h;t.default=m},132:function(e,t,n){var r=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.build_interactions_sm=T,t.default=void 0;var a=r(n(39)),i=r(n(74)),o=n(85),s=(0,o.assign)({start_state_history:function(e,t){var n=e.tutor.get_state(),r=e.start_state_history||[];return r.push(n),r}}),l=(0,o.assign)({state:function(e,t){return null==e.staged_SAI||e.staged_SAI.reward>0||e.test_mode?e.tutor.get_state():e.state}}),c=(0,o.assign)({staged_SAI:function(e,t){return(0,i.default)(e.staged_SAI,{foci_of_attention:e.tutor.get_current_foci()}),e.staged_SAI}});function u(e,t){var n=e.staged_SAI;return!(e.feedback_map&&Object.keys(e.feedback_map).length>0)&&("done"===n.selection&&(null==n.reward||n.reward>0||e.test_mode))}function d(e,t){var n=e.staged_SAI;return n.skipTraining&&n.reward<0||e.examples_only}function f(e,t){return e.free_author||!1}function p(e,t){return t.data>0}function _(e,t){return console.log("CCCC",e),!Object.keys(t.data).length||e.examples_only}function h(e,t){console.error(t.data)}function g(e,t){e.network_layer.kill_this(t.data.toString())}function m(e,t){var n=e.network_layer,r=e.staged_SAI,a=e.action_type;if(e.feedback_map&&0!==Object.keys(e.feedback_map).length)for(var i in e.feedback_map){var o=e.skill_applications[i];a=e.feedback_map[i].toUpperCase(),s=null!=o.inputs.value?o.inputs.value:"";n.term_print(a+": "+o.selection+" -> "+s,a)}else{"ATTEMPT"==a&&(a=r.reward>0?"CORRECT":"INCORRECT");var s=null!=r.inputs.value?r.inputs.value:"";n.term_print(a+": "+r.selection+" -> "+s,a)}}function v(e,t){e.app.setState({skill_panel_props:{skill_set:{"Applicable Skills":{}}}})}function b(e,t){e.app.setState({skill_panel_props:{skill_set:{"Applicable Skills":t.data.responses||{}}}})}var y=(0,o.send)(function(e,t){t.skill;var n=t.match,r=t.label,i=n._id,o=e.feedback_map||{},s=o[i]&&r===o[i]?null:r,l=(0,a.default)({},o);return null===s?delete l[i]:l[i]=s,{type:"FEEBACK_MAP_UPDATE",feedback_map:l,was_empty:0===Object.keys(o).length,now_empty:0===Object.keys(l).length}}),k=(0,o.assign)({feedback_map:function(e,t){return e.skill_panel.updateFeedbackMap&&e.skill_panel.updateFeedbackMap(t.feedback_map),e.tutor.updateFeedbackMap&&e.tutor.updateFeedbackMap(t.feedback_map),t.feedback_map}}),S=(0,o.send)(function(e,t){return!t.was_empty&&t.now_empty?(console.log("EMPTY"),{type:"SKILL_PANEL_FEEDBACK_EMPTY"}):t.was_empty&&!t.now_empty?(console.log("NOT EMPTY"),{type:"SKILL_PANEL_FEEDBACK_NONEMPTY"}):{type:""}});function T(e,t){var n,r={app:e,tutor:e.tutor.current,skill_panel:e.skill_panel.current,buttons:e.buttons.current,network_layer:e.network_layer,staged_SAI:null,action_type:null};return n=(r=(0,a.default)({},r,t)).tutor_mode?A:r.interactive?E:x,(0,o.Machine)((0,a.default)({},{context:r},n),function(e){var t=e.tutor.current,n=(e.skill_panel.current,e.network_layer.current,e.network_layer);return{services:{sendFeedback:function(e,t){return e.staged_SAI.skipTraining||e.test_mode?Promise.resolve(!0):n.sendFeedback(e,t)},sendFeedbackExplicit:function(e,t){return n.sendFeedbackExplicit(e,t)},applyNextExample:t.applyNextExample,attemptStagedSAI:t.attemptStagedSAI,queryApprentice:n.queryApprentice,checkApprentice:n.checkApprentice},actions:{logError:h,stateRecalc:l,assignResponse:(0,o.assign)({response:function(e,t){return t.data}}),assignStagedSAI:(0,o.assign)({staged_SAI:function(e,t){return t.data}}),assignExample:(0,o.assign)({action_type:function(e,t){return"EXAMPLE"}}),assignAttempt:(0,o.assign)({action_type:function(e,t){return"ATTEMPT"}}),assignCorrect:(0,o.assign)({staged_SAI:function(e,t){return(0,a.default)({},e.staged_SAI,{reward:1})}}),assignIncorrect:(0,o.assign)({staged_SAI:function(e,t){return(0,a.default)({},e.staged_SAI,{reward:-1})}}),assignFoci:c,clearFeedbackData:(0,o.assign)(function(e,t){return{reward:null,staged_SAI:null,skill_applications:null,feedback_map:null}}),assignSkillApplications:(0,o.assign)({skill_applications:function(e,t){return t.data.responses||t.data.skill_applications}}),printFeedback:m,kill_this:g,printEvent:function(e,t){console.log("P_EVT:",t)},fillSkillPanel:b,clearSkillPanel:v,done:function(e,t){e.app.training_service.send("PROBLEM_DONE")},enterSetStartStateMode:t.enterSetStartStateMode,exitSetStartStateMode:t.exitSetStartStateMode,enterFeedbackMode:t.enterFeedbackMode,exitFeedbackMode:t.exitFeedbackMode,enterFociMode:t.enterFociMode,exitFociMode:t.exitFociMode,enterTutoringMode:t.enterTutoringMode,exitTutoringMode:t.exitTutoringMode,displayCorrectness:t.displayCorrectness,applyStagedSAI:function(e,n){t.applySAI(e.staged_SAI)},proposeSAI:function(e,n){return t.proposeSAI(n.data)},confirmProposedSAI:function(e,n){t.confirmProposedSAI()},clearProposedSAI:function(e,n){t.clearProposedSAI()},recalcFeedbackMap:y,assignFeedbackMap:k,toggleFeedbackStyle:S,generate_nools:n.generate_nools,appendStartHistory:s},guards:{saiIsCorrectDone:u,forceUseExample:d,noApplicableSkills:_,isFreeAuthor:f,checkIsCorrect:p}}}(e))}var x={initial:"Start",states:{Start:{entry:"stateRecalc",on:{"":"Querying_Apprentice"}},Querying_Apprentice:{invoke:{id:"queryApprentice",src:"queryApprentice",onDone:[{target:"Applying_Next_Example",cond:"noApplicableSkills"},{target:"Applying_Staged_SAI",actions:["assignStagedSAI"]}],onError:"Fail"},exit:"assignResponse"},Applying_Staged_SAI:{invoke:{id:"attemptStagedSAI",src:"attemptStagedSAI",onDone:{target:"Sending_Feedback",actions:["assignStagedSAI","assignAttempt"]},onError:"Fail"}},Applying_Next_Example:{invoke:{id:"applyNextExample",src:"applyNextExample",onDone:{target:"Sending_Feedback",actions:["assignStagedSAI","assignExample"]},onError:"Fail"}},Sending_Feedback:{entry:"printFeedback",invoke:{id:"sendFeedback",src:"sendFeedback",onDone:[{target:"Done",cond:"saiIsCorrectDone"},{target:"Applying_Next_Example",cond:"forceUseExample"},{target:"Querying_Apprentice"}],onError:"Fail"},exit:["stateRecalc","assignResponse","clearFeedbackData"]},Done:{type:"final",entry:"done"},Fail:{entry:["logError","kill_this"]}}},E={id:"interactive",initial:"Start",states:{Start:{entry:"stateRecalc",on:{"":[{target:"Setting_Start_State",cond:"isFreeAuthor"},{target:"Querying_Apprentice"}]}},Setting_Start_State:{entry:"enterSetStartStateMode",on:{START_STATE_SET:{target:"Querying_Apprentice",actions:["appendStartHistory"]}},exit:["exitSetStartStateMode","stateRecalc"]},Querying_Apprentice:{invoke:{id:"queryApprentice",src:"queryApprentice",onDone:[{target:"Waiting_User_Feedback.Waiting_Demonstrate_Only",cond:"noApplicableSkills",actions:["fillSkillPanel"]},{target:"Waiting_User_Feedback.Waiting_Yes_No_Feedback",actions:["fillSkillPanel","proposeSAI","assignStagedSAI"]}],onError:"Fail"},exit:"assignSkillApplications"},Waiting_User_Feedback:{entry:"enterFeedbackMode",initial:"Waiting_Demonstrate_Only",states:{Waiting_Demonstrate_Only:{},Waiting_Yes_No_Feedback:{on:{SKILL_PANEL_FEEDBACK_NONEMPTY:"Waiting_Submit_Feedback",YES_PRESSED:{target:"#interactive.Sending_Feedback",actions:["assignCorrect","assignAttempt","confirmProposedSAI"]},NO_PRESSED:{target:"#interactive.Sending_Feedback",actions:["assignIncorrect","assignAttempt","clearProposedSAI"]}}},Waiting_Submit_Feedback:{on:{SKILL_PANEL_FEEDBACK_EMPTY:"Waiting_Yes_No_Feedback",SUBMIT_SKILL_FEEDBACK:{target:"#interactive.Sending_Feedback",actions:["clearProposedSAI"]}}}},on:{STAGE_SAI:{actions:["assignStagedSAI","proposeSAI"]},TOGGLE_FEEDBACK:{actions:"recalcFeedbackMap"},FEEBACK_MAP_UPDATE:{actions:["assignFeedbackMap","toggleFeedbackStyle"]},DEMONSTRATE:{target:"Waiting_Select_Foci",actions:["assignStagedSAI","assignExample","printEvent","clearProposedSAI"]},GEN_NOOLS:{actions:["generate_nools"]}},exit:["exitFeedbackMode"]},Waiting_Select_Foci:{entry:"enterFociMode",on:{"":{target:"Sending_Feedback",actions:"assignFoci",cond:"saiIsCorrectDone"},FOCI_DONE:{target:"Sending_Feedback",actions:"assignFoci"}},exit:"exitFociMode"},Sending_Feedback:{entry:["printFeedback"],invoke:{id:"sendFeedback",src:"sendFeedback",onDone:[{target:"Done",cond:"saiIsCorrectDone"},{target:"Querying_Apprentice"}],onError:"Fail"},exit:["stateRecalc","assignResponse","clearFeedbackData"]},Done:{type:"final",entry:["clearSkillPanel","done"]},Fail:{entry:["logError","kill_this"]}}},A={id:"interactive",initial:"Start",states:{Start:{entry:"stateRecalc",on:{"":[{target:"Setting_Start_State",cond:"isFreeAuthor"},{target:"Waiting_User_Attempt"}]}},Setting_Start_State:{entry:"enterSetStartStateMode",on:{START_STATE_SET:{target:"Waiting_User_Attempt",actions:["appendStartHistory"]}},exit:["exitSetStartStateMode","stateRecalc"]},Waiting_User_Attempt:{entry:["enterTutoringMode","stateRecalc"],on:{ATTEMPT:{target:"Checking_Against_Apprentice",actions:"assignStagedSAI"}},exit:"exitTutoringMode"},Checking_Against_Apprentice:{invoke:{id:"checkApprentice",src:"checkApprentice",onDone:[{cond:"saiIsCorrectDone",target:"Done",actions:["displayCorrectness","assignCorrect"]},{cond:"checkIsCorrect",target:"Waiting_User_Attempt",actions:["displayCorrectness","assignCorrect"]},{target:"Waiting_User_Attempt",actions:["displayCorrectness","assignIncorrect"]}]}},Done:{type:"final",entry:["clearSkillPanel","done"]}}},C=T;t.default=C},191:function(e,t,n){e.exports=n(192)},192:function(e,t,n){var r=n(73),a=n(29),i=a(n(74)),o=a(n(39)),s=a(n(1)),l=a(n(33));n(196);a(n(117)),a(n(129));var c=r(n(233)),u=(n(85),a(n(234))),d=a(n(245)),f=a(n(133)),p={ctatttutor:u.default,ctat:u.default};function _(e){var t;try{t=JSON.parse(e)}catch(n){t=null}return t}var h,g=function(){var e=new URLSearchParams(window.location.search.substring(1));console.log(window.location.search),console.log(e);var t={AL_URL:e.get("al_url"),OUTER_LOOP_URL:e.get("outer_loop_url"),HOST_URL:window.location.origin,training_file:e.get("training"),interactive:_((e.get("interactive")||"").toLowerCase()),use_foci:_((e.get("use_foci")||"").toLowerCase()),tutor:e.get("tutor"),nools_dir:e.get("nools_dir")};return console.log("PROPS",t,e.get("interactive")),t}();g.training_file=g.training_file||"/stylus_author.json",(h=g.training_file,fetch(h).then(function(e){return e.text()}).then(function(e){return f.default.parse(e)})).then(function(e){var t=e.set_params;(g=(0,o.default)({},t,function(e){var t={};return console.log(e),Object.keys(e).forEach(function(n){console.log(n),null!=e[n]&&(t[n]=e[n])}),t}(g))).tutor=(g.tutor||"ctat").toLowerCase().replace("_",""),l.default.render(s.default.createElement(d.default,(0,i.default)({ref:function(e){window.react_interface=e},style:{height:"100%"},tutorClass:p[g.tutor]},g)),document.getElementById("root"))}),c.unregister()},196:function(e,t,n){},231:function(e,t,n){e.exports=n.p+"static/media/Arrowhead-01-128.3fbf838f.png"},232:function(e,t,n){e.exports=n.p+"static/media/Arrowhead-Down-01-128.912d4e8d.png"},233:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.register=function(e){if("serviceWorker"in navigator){var t=new URL(".",window.location.href);if(t.origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat(".","/service-worker.js");r?(!function(e,t){fetch(e).then(function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):a(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):a(t,e)})}},t.unregister=function(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})};var r=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function a(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}},234:function(e,t,n){var r=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(57)),i=r(n(39)),o=r(n(74)),s=r(n(53)),l=r(n(43)),c=r(n(44)),u=r(n(54)),d=r(n(55)),f=r(n(56)),p=r(n(75)),_=r(n(1)),h=r(n(235)),g=r(n(92)),m=(n(49),n(240)),v=n(77),b=n(244);function y(e,t){for(var n=!1,r=t.length-1;r>=0;r--){var a=t[r];e.classList.contains(a)&&(n=!0)}return n}var k=function(e){function t(e){var n;return(0,l.default)(this,t),n=(0,u.default)(this,(0,d.default)(t).call(this,e)),(0,g.default)((0,p.default)((0,p.default)(n))),n.where_colors=["darkorchid","#ff884d","#52d0e0","#feb201","#e44161","#ed3eea","#2f85ee","#562ac6","#cc24cc"],n.relative_pos_cache={},n.color_class_map={EXAMPLE:"CTAT--example",CORRECT:"CTAT--correct",INCORRECT:"CTAT--incorrect",HIGHLIGHT:"CTAT--AL_highlight",START_STATE:"CTAT--AL_start",ATTEMPT:"",DEFAULT:""},n.ctat_webview=_.default.createRef(),n.state={source:"../../examples/FracPreBake/FractionArithmetic/HTML/fraction_arithmetic.html?question_file=../mass_production/mass_production_brds/AD 5_9_plus_3_7.brd"},n.start_state_history=[],n.highlighted_elements=[],n}return(0,f.default)(t,e),(0,c.default)(t,[{key:"componentDidMount",value:function(){console.log("THIS",this)}},{key:"componentDidUpdate",value:function(e,t){console.log("UPDATED",this.state),this.iframe=this.ctat_webview.current,this.init_callback||(this.init_callback=function(e){})}},{key:"loadProblem",value:function(e){var t=this,n=e.prob_obj,r=e.network_layer,a=e.interactive;return this.interactive=e.interactive,this.setState({source:{html:S}}),new Promise(function(i,l){var c=n.HTML.substring(n.HTML.lastIndexOf("/")+1).replace(".html",""),u=n.domain_name||c,d=n.HTML;v.isAbsolute(d)||(d=v.join(e.working_dir||"/",d));var f,p,_=void 0!=n.question_file&&"INTERACTIVE"!=n.question_file.toUpperCase();_?(f=n.question_file.substring(n.question_file.lastIndexOf("/")+1).replace(".brd","").replace(".nools",""),p=!1):(f="FREE AUTHORING",p=!0),r.term_print("Starting Problem: "+f,"INFO");var h=_?{question_file:n.question_file}:{question_file:"/src/empty.nools"};console.log("qf",h,a,n),!a&&h.question_file.includes(".nools")&&r.kill_this("Question file cannot be nools in non-interactive mode. Use example tracing.");var g={problem_name:f,dataset_level_name1:u,dataset_level_type1:"Domain",SessionLog:"true",Logging:"ClientToLogServer",log_service_url:window.location.origin,user_guid:e.agent_name,session_id:e.session_id};if("problem_context"in n&&(g.problem_context=n.problem_context),"custom_fields"in n){var b=n.custom_fields,y=!0,k=!1,S=void 0;try{for(var T,x=Object.keys(b).entries()["function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(y=(T=x.next()).done);y=!0){var E=T.value,A=(0,s.default)(E,2),C=A[0],w=A[1];g["custom_field_name"+String(C)]=w,g["custom_field_value"+String(C)]=b[w]}}catch(L){k=!0,S=L}finally{try{y||null==x.return||x.return()}finally{if(k)throw S}}}var I=(0,o.default)({},h,g);t.HTML_PATH=d,t.init_callback=function(){i({updateContext:{free_author:p}})};var O=d+"?"+m.stringify(I);console.log("source",O),t.graph=null,t.commLibrary=null,t.hasConfig=null,t.setState({source:{uri:O},onLoad:t._triggerWhenInitialized,steps:n.only_step_ids?n.only_step_ids.flat():null,selections:n.only_Selections?n.only_Selections.flat():null})})}},{key:"_inject_element",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.iframe_content.document.createElement(e);for(var r in t)n.setAttribute(r,t[r]);this.iframe_content.document.getElementsByTagName("head")[0].appendChild(n)}},{key:"_triggerWhenInitialized",value:function(){var e=this;console.log("TRIGGER WHEN INITIALIZED"),this.iframe_content=this.iframe.frameRef.contentWindow;var t=this.iframe_content;if("undefined"==typeof t.CTAT||null==t.CTAT||"undefined"==typeof t.CTATCommShell||null==t.CTATCommShell||"undefined"==typeof t.CTATCommShell.commShell||null==t.CTATCommShell.commShell||"undefined"==typeof t.CTAT.ToolTutor||null==t.CTAT.ToolTutor||"undefined"==typeof t.CTAT.ToolTutor.tutor||null==t.CTAT.ToolTutor.tutor)return console.log("BLEHH1"),void window.setTimeout(function(){e._triggerWhenInitialized()},500);this.graph=t.CTAT.ToolTutor.tutor.getGraph()||!1,this.commLibrary=t.CTATCommShell.commShell.getCommLibrary(),this.hasConfig=void 0!=t.CTATConfiguration,(this.graph||this.interactive)&&this.commLibrary&&this.hasConfig?(this._inject_element("link",{href:"/css/AL_colors.css",type:"text/css",rel:"stylesheet"}),t.flashVars.setParams({deliverymode:"bleehhhh"}),this.CTAT_CORRECT=t.CTAT.Component.Base.Tutorable.EventType.correct,this.CTAT_INCORRECT=t.CTAT.Component.Base.Tutorable.EventType.incorrect,this.CTAT_ACTION=t.CTAT.Component.Base.Tutorable.EventType.action,console.log("INITIALIZED!"),this.init_callback(this)):(console.log("BLEHH2"),window.setTimeout(function(){e._triggerWhenInitialized()},500))}},{key:"handle_user_set_state",value:function(e){var t=e.detail.sai,n=t.getSelection();""!=t.getInput()?(this.colorElement(n,"START_STATE"),this.start_state_elements.push(n)):(this.colorElement(n,"DEFAULT"),this.start_state_elements.includes(n)&&this.start_state_elements.remove(n))}},{key:"enterSetStartStateMode",value:function(){this.start_state_elements=[],this.iframe_content.document.addEventListener(this.CTAT_ACTION,this.handle_user_set_state)}},{key:"exitSetStartStateMode",value:function(){for(var e in this.iframe_content.document.removeEventListener(this.CTAT_ACTION,this.handle_user_set_state),console.log("START DONE"),this.start_state_elements){var t=this.start_state_elements[e];this.iframe_content.document.getElementById(t).firstChild.value&&this.lockElement(t),this.colorElement(t,"DEFAULT")}this.start_state_history.push(this.get_state())}},{key:"handleUserExample",value:function(e){this.handleUserInput(e,"EXAMPLE")}},{key:"handleUserAttempt",value:function(e){this.handleUserInput(e,"ATTEMPT")}},{key:"handleUserInput",value:function(e,t){var n=(r=e.detail.sai).getSelection();if("false"!=this.iframe_content.document.getElementById(n).firstChild.contentEditable){var r={selection:r.getSelection(),action:r.getAction(),inputs:{value:r.getInput()}};if(this.lockElement(n),this.colorElement(n,t),"EXAMPLE"==t)this.props.interactions_service.send({type:"DEMONSTRATE",data:(0,i.default)({},r,{reward:1})});else{if("ATTEMPT"!=t)throw"uknown type given";console.log("SEND ATTEMPT",r),this.props.interactions_service.send({type:"ATTEMPT",data:(0,i.default)({},r)})}}else console.log("BAIL")}},{key:"displayCorrectness",value:function(e,t){var n=e.staged_SAI.selection;1==t.data?this.colorElement(n,"CORRECT"):(this.colorElement(n,"INCORRECT"),this.unlockElement(n))}},{key:"_done_clicked_example",value:function(e){this.handleUserExample({detail:{sai:new this.iframe_content.CTATSAI("done","ButtonPressed","-1")}})}},{key:"enterFeedbackMode",value:function(){this.iframe_content.document.addEventListener(this.CTAT_ACTION,this.handleUserExample),this.iframe_content.document.getElementById("done").addEventListener("click",this._done_clicked_example)}},{key:"exitFeedbackMode",value:function(){this.iframe_content.document.removeEventListener(this.CTAT_ACTION,this.handleUserExample),this.iframe_content.document.getElementById("done").removeEventListener("click",this._done_clicked_example)}},{key:"_done_clicked_attempt",value:function(e){this.handleUserAttempt({detail:{sai:new this.iframe_content.CTATSAI("done","ButtonPressed","-1")}})}},{key:"enterTutoringMode",value:function(){this.iframe_content.document.addEventListener(this.CTAT_ACTION,this.handleUserAttempt),this.iframe_content.document.getElementById("done").addEventListener("click",this._done_clicked_attempt)}},{key:"exitTutoringMode",value:function(){this.iframe_content.document.removeEventListener(this.CTAT_ACTION,this.handleUserAttempt),this.iframe_content.document.getElementById("done").removeEventListener("click",this._done_clicked_attempt)}},{key:"handle_foci_select",value:function(e){console.log("FOCI SELECT!");var t=!0,n=!1,r=void 0;try{for(var a,i=e.path["function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(t=(a=i.next()).done);t=!0){var o=a.value;if(console.log("EELE",o),void 0!=o.classList&&o.classList.contains("CTATComponent")){var s=this.current_foci.indexOf(o);-1==s?(this.current_foci.push(o),this.highlightElement(o.id,1)):(this.current_foci.splice(s,1),this.unhighlightElement(o.id)),console.log(this.current_foci);break}}}catch(l){n=!0,r=l}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"enterFociMode",value:function(){console.log("FOCI START!"),this.unhighlightAll(),this.current_foci=[],this.iframe_content.document.addEventListener("click",this.handle_foci_select)}},{key:"get_current_foci",value:function(){return this.current_foci?this.current_foci.map(function(e){return e.id}):[]}},{key:"exitFociMode",value:function(){this.unhighlightAll(),console.log("FOCI DONE!"),this.current_foci=[],this.iframe_content.document.removeEventListener("click",this.handle_foci_select)}},{key:"_shouldSkipTraining",value:function(e){if(!this.state.steps&&!this.state.selections)return!1;if(this.state.steps){var t=this.iframe_content.CTAT.ToolTutor.tutor.getTracer().getLastResult().getStepID();if(console.log("stepId:",t),this.state.steps.includes(t))return!1}return!this.state.selections||!this.state.selections.includes(e.selection)}},{key:"attemptStagedSAI",value:function(e,t){var n=this;return new Promise(function(t,r){var a=e.staged_SAI,o=n.iframe_content.document.getElementById(a.selection),s=n.CTAT_CORRECT,l=n.CTAT_INCORRECT,c=n._shouldSkipTraining,u=n.lockElement;function d(n){console.log("EVENT",n),console.log("EVENT",n.detail.sai.getTransactionID()),o.removeEventListener(s,d),o.removeEventListener(l,d),console.log("MOOOOOOOO",e),e.test_mode&&u(a.selection),t((0,i.default)({},a,{reward:n.type==s?1:-1,skipTraining:c(a)}))}o.addEventListener(s,d),o.addEventListener(l,d),n.applySAI(a)})}},{key:"applyNextExample",value:function(e,t){var n=this;return new Promise(function(e,t){n.applyHint();var r=n.getDefaultSAI();n.colorElement(r.selection,"EXAMPLE"),n.applySAI(r),e((0,i.default)({},r,{reward:1,skipTraining:n._shouldSkipTraining(r)}))})}},{key:"applySAI",value:function(e){var t=this.iframe_content.document.getElementById(e.selection);if("false"==(t["data-ctat-enabled"]||"true")){var n=new CustomEvent(this.CTAT_INCORRECT,{detail:{sai:e,component:t},bubbles:!0,cancelable:!0});t.dispatchEvent(n)}"ButtonPressed"==e.action&&(e.inputs={value:-1});var r=new(0,this.iframe_content.CTATSAI)(e.selection,e.action,e.inputs.value);this.iframe_content.CTATCommShell.commShell.processComponentAction(r,!0)}},{key:"lockElement",value:function(e){this.iframe_content.CTATShellTools.findComponent(e)[0].setEnabled(!1)}},{key:"unlockElement",value:function(e){this.iframe_content.CTATShellTools.findComponent(e)[0].setEnabled(!0)}},{key:"colorElement",value:function(e,t){var n=this.iframe_content.document.getElementById(e);n&&n.firstElementChild&&n.firstElementChild.setAttribute("class",this.color_class_map[t])}},{key:"highlightElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.unhighlightElement(e),this.iframe_content.document.getElementById(e.replace("?ele-","")).firstElementChild.classList.add("CTAT--AL_highlight"+t),this.highlighted_elements.push(e)}},{key:"unhighlightElement",value:function(e){if(this.highlighted_elements.includes(e)){for(var t=this.iframe_content.document.getElementById(e.replace("?ele-","")),n=(t.firstElementChild.classList.toString(),1);n<=this.where_colors.length;n++){var r="CTAT--AL_highlight"+n;t.firstElementChild.classList.contains(r)&&t.firstElementChild.classList.remove(r)}t.firstElementChild.classList.toString();var a=this.highlighted_elements.indexOf(e);a>-1&&this.highlighted_elements.splice(a,1)}}},{key:"clearElement",value:function(e){this.iframe_content.document.getElementById(e).firstElementChild.value=""}},{key:"highlightSAI",value:function(e){if(e.mapping){var t=0;for(var n in e.mapping){var r=e.mapping[n],a=1;"?sel"!=n&&(a=2+(t-1)%(this.where_colors.length-1)),this.highlightElement(r,a),t++}}else alert("RESPONSE IS MISSING FIELD:'mapping'")}},{key:"unhighlightAll",value:function(){for(var e=0,t=(0,a.default)(this.highlighted_elements);e<t.length;e++){var n=t[e];this.unhighlightElement(n)}}},{key:"getDefaultSAI",value:function(){var e=this.graph.getExampleTracer().getBestNextLink().getDefaultSAI();return e={selection:e.getSelection(),action:e.getAction(),inputs:{value:e.getInput()}}}},{key:"clearProposedSAI",value:function(){this.proposed_SAI&&(this.clearElement(this.proposed_SAI.selection),this.unlockElement(this.proposed_SAI.selection.replace("?ele-","")),this.unhighlightAll(),this.proposed_SAI=null)}},{key:"proposeSAI",value:function(e){this.clearProposedSAI(),this.proposed_SAI=(0,i.default)({},e),this.highlightSAI(e),this.stageSAI(e)}},{key:"stageSAI",value:function(e){var t=this.iframe_content.CTATShellTools.findComponent(e.selection)[0],n=new this.iframe_content.CTATSAI(e.selection,e.action,e.inputs.value);t.executeSAI(n),this.lockElement(e.selection)}},{key:"confirmProposedSAI",value:function(){this.proposed_SAI&&(this.unhighlightAll(),this.proposed_SAI=null)}},{key:"applyHint",value:function(){this.commLibrary.sendXML("<message><properties><MessageType>InterfaceAction</MessageType><Selection><value>hint</value></Selection><Action><value>ButtonPressed</value></Action><Input><value><![CDATA[hint request]]></value></Input></properties></message>")}},{key:"get_state",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.encode_relative,n=void 0===t||t,r=e.strip_offsets,a=void 0===r||r,i=e.use_offsets,l=void 0===i||i,c=e.use_class,u=void 0===c||c,d=e.use_id,f=void 0===d||d,p=e.append_ele,_=void 0===p||p,h=e.numeric_values,g=void 0!==h&&h,m=this.relative_pos_cache,v=this.HTML_PATH,k=this.iframe_content.$("div").toArray(),S={};if(b.each(k,function(e,t){if(M={},t.classList.contains("CTATComponent")&&!t.classList.contains("CTATTable")&&"CTATTextField"!=t.classList[0]){if(u&&(M.type=t.classList[0]),l&&(M.offsetParent=t.offsetParent.dataset.silexId,M.offsetLeft=t.offsetLeft,M.offsetTop=t.offsetTop,M.offsetWidth=t.offsetWidth,M.offsetHeight=t.offsetHeight),f&&(M.id=t.id),y(t,["CTATTextInput","CTATComboBox","CTATTable--cell"])&&(M.value=t.firstElementChild.value,g&&(M.value=Number(M.value)||M.value),M.contentEditable="true"==t.firstElementChild.contentEditable),y(t,["CTATComboBox"])){for(var n=t.firstElementChild.options,r=[],a=0;a<n.length;a++)r.push(n[a].text);M.options=(0,o.default)({},r)}var i=(_?"?ele-":"")+t.id;S[i]=M,0}}),n){var T,x=Object.entries(S);if(v in m)T=m[v];else{T={};for(var E=0;E<x.length;E++)T[x[E][0]]={to_left:[],to_right:[],above:[],below:[]};for(E=0;E<x.length;E++)for(var A=0;A<x.length;A++)if(E!=A){var C=(0,s.default)(x[E],2),w=C[0],I=C[1],O=(0,s.default)(x[A],2),L=O[0],P=O[1];if(I.offsetTop>P.offsetTop&&I.offsetLeft<P.offsetLeft+P.offsetWidth&&I.offsetLeft+I.offsetWidth>P.offsetLeft){var F=I.offsetTop-P.offsetTop;T[w].above.push([L,F]),T[L].below.push([w,F])}if(I.offsetLeft<P.offsetLeft&&I.offsetTop+I.offsetHeight>P.offsetTop&&I.offsetTop<P.offsetTop+P.offsetHeight){F=P.offsetLeft-I.offsetLeft;T[w].to_right.push([L,F]),T[L].to_left.push([w,F])}}var R=function(e){return e[0]},N=function(e,t){return e[1]-t[1]};for(E=0;E<x.length;E++){(D=T[x[E][0]]).below=D.below.sort(N).map(R)[0]||"",D.above=D.above.sort(N).map(R)[0]||"",D.to_right=D.to_right.sort(N).map(R)[0]||"",D.to_left=D.to_left.sort(N).map(R)[0]||""}m[v]=T}for(E=0;E<x.length;E++){var M=S[x[E][0]],D=T[x[E][0]];M.below=D.below,M.above=D.above,M.to_right=D.to_right,M.to_left=D.to_left,a&&(delete M.offsetTop,delete M.offsetLeft,delete M.offsetWidth,delete M.offsetHeight),S[x[E][0]]=M}}return console.log("STATE JSON",S),S}},{key:"render",value:function(){return _.default.createElement(h.default,{ref:this.ctat_webview,originWhitelist:["*"],source:this.state.source,onLoad:this.state.onLoad})}}]),t}(_.default.Component),S='<!DOCTYPE html> <html><head><meta name="viewport" content="width=device-width, initial-scale=1"><style>.loader {  border: 16px solid #f3f3f3;  border-radius: 50%;  border-top: 16px solid #3498db;  width: 120px;  height: 120px;  -webkit-animation: spin 2s linear infinite; /* Safari */  animation: spin 2s linear infinite;  position: absolute;  left: 50%;  top: 50%;  transform: translate(-50%, -50%);*/}/* Safari */@-webkit-keyframes spin {  0% { -webkit-transform: rotate(0deg); }  100% { -webkit-transform: rotate(360deg); }}@keyframes spin {  0% { transform: rotate(0deg); }  100% { transform: rotate(360deg); }}</style></head><body><h2>How To Create A Loader</h2><div class="loader"></div></body></html>',T=k;t.default=T},245:function(e,t,n){var r=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(74)),i=r(n(43)),o=r(n(44)),s=r(n(54)),l=r(n(55)),c=r(n(56)),u=r(n(75)),d=r(n(117)),f=r(n(129)),p=n(132),_=n(246),h=r(n(335)),g=n(85),m=r(n(92)),v=(r(n(77)),r(n(171))),b=r(n(1)),y=n(49);var k=function(e){function t(e){var n;if((0,i.default)(this,t),n=(0,s.default)(this,(0,l.default)(t).call(this,e)),(0,m.default)((0,u.default)((0,u.default)(n))),n.onInteractionTransition=n.onInteractionTransition.bind((0,u.default)((0,u.default)(n))),n.network_layer=new h.default(e.AL_URL,e.HOST_URL,e.OUTER_LOOP_URL),null==e.working_dir&&null!=e.training_file){var r=e.training_file.match(/(.*)[\/\\]/);e.working_dir=r?r[1]:""}return n.tutor=b.default.createRef(),n.skill_panel=b.default.createRef(),n.buttons=b.default.createRef(),n.state={default_props:{},buttons_props:{app:(0,u.default)((0,u.default)(n))},tutor_props:n.props.tutor_props||{},skill_panel_props:{},training_description:"????",agent_description:"????",problem_description:"????",interactive:n.props.interactive,free_author:n.props.free_author,tutor_mode:n.props.tutor_mode},n}return(0,c.default)(t,e),(0,o.default)(t,[{key:"onInteractionTransition",value:function(e){console.log("#",e.value,":",e.context,e);var t={interactions_state:e,interactions_service:this.interactions_service};this.setState({default_props:t})}},{key:"onTrainingTransition",value:function(e){var t=e.context;console.log("&","HEY THIS IS THIS THING"),t.interactive||this.setState({training_description:t.training_description||"???",agent_description:t.agent_description||"???",problem_description:t.problem_description||"???"})}},{key:"changeInteractionMode",value:function(e){this.setState(e)}},{key:"componentDidUpdate",value:function(e,t){var n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return console.log(n),Object.keys(t).reduce(function(r,a){return e[a]===t[a]||null!=n&&!n.includes(a)||(r[a]=t[a]),r},{})}(t,this.state,["interactive","free_author","tutor_mode"]);Object.keys(n).length>0&&(console.log("componentDidUpdate",n),this.training_service.send({type:"CHANGE_INTERACTION_MODE",data:n}))}},{key:"componentDidMount",value:function(){var e,t,n=this;console.log("MOUNTED");var r=[this.tutor.current,this.network_layer,this.props.working_dir,this.props.training_file];e=r[2],t=r[3],this.interactions_sm=(0,p.build_interactions_sm)(this,(0,v.default)(this.props,_.problem_props)),this.interactions_service=null,this.training_machine=(0,_.build_training_sm)(this,this.interactions_sm,t,e),this.training_service=(0,g.interpret)(this.training_machine),this.training_service.onTransition(this.onTrainingTransition),this.training_service.start();this.training_service.subscribe(function(e){console.log("SUBSCRIBE:",e)});console.log("T MACHINE!",this.training_service),window.setTutorMode=function(e){n.changeInteractionMode({tutor_mode:e})},window.setInteractive=function(e){n.changeInteractionMode({interactive:e})},window.setFreeAuthor=function(e){n.changeInteractionMode({free_author:e})},window.generateBehaviorProfile=this.generateBehaviorProfile}},{key:"generateBehaviorProfile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/ground_truth.json",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.network_layer.generateBehaviorProfile,r=this.training_service._state.context;if(null!=e){return"/"!=e[0]&&(e=(r.working_dir||"/")+e),fetch(e).then(function(e){return e.text()}).then(function(e){return e.split("\n")}).then(function(e){return function(e){var t=[],n=!0,r=!1,a=void 0;try{for(var i,o=e["function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(n=(i=o.next()).done);n=!0){var s=i.value;if(""!=s){var l=JSON.parse(s);t.push(l)}}}catch(c){r=!0,a=c}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}(e)}).then(function(e){return n(r,{data:{requests:e,out_dir:t}})})}return n(r)}},{key:"render",value:function(){var e,t,n=this.props.tutorClass;this.state.interactive?e=b.default.createElement(y.View,{style:S.controls},!this.state.tutor_mode&&b.default.createElement(y.View,{style:S.skill_panel},b.default.createElement(d.default,(0,a.default)({ref:this.skill_panel},this.state.default_props,this.state.skill_panel_props))),b.default.createElement(y.View,{style:S.buttons},b.default.createElement(f.default,(0,a.default)({ref:this.buttons},this.state.default_props,this.state.buttons_props,{tutor_mode:this.state.tutor_mode})))):(t=this.state.training_description+"\n"+this.state.agent_description+"\n"+this.state.problem_description+"\n",e=b.default.createElement(y.View,{style:S.prompt},b.default.createElement(y.Text,null,t)));return b.default.createElement(y.View,{style:S.container},b.default.createElement(y.View,{style:S.ctat_tutor},b.default.createElement(n,(0,a.default)({ref:this.tutor,id:"tutor_iframe",interactive:!1},this.state.default_props,this.state.tutor_props))),e)}}]),t}(b.default.Component);t.default=k;var S=y.StyleSheet.create({container:{flex:1,flexDirection:"column"},ctat_tutor:{margin:4,flexBasis:"65%",flex:1},prompt:{flex:1,textAlign:"center"},controls:{flex:1,flexBasis:"35%",flexDirection:"row"},skill_panel:{flex:1,flexBasis:"60%"},buttons:{flexGrow:1,flexDirection:"column",flexBasis:"40%",justifySelf:"space-around"}})},246:function(e,t,n){var r=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.build_training_sm=function(e,t){var n=e.network_layer,r={app:e,tutor:e.tutor.current,skill_panel:e.skill_panel.current,buttons:e.buttons.current,network_layer:e.network_layer,interactive:e.props.interactive,training_file:e.props.training_file,working_dir:e.props.working_dir,interactions_sm:t,file_params:null,agent_params:null,prob_obj:null};return r=(0,s.default)({},m,r),(0,c.Machine)({context:r,initial:"Loading_Training_File",states:{Loading_Training_File:{invoke:{id:"load_training_file",src:"load_training_file",onDone:{target:"Serving_Training_Sets",actions:"updateContext"},onError:{target:"Fail",actions:"logError"}}},Serving_Training_Sets:{invoke:{id:"serve_next_training_set",src:"serve_next_training_set",onDone:[{target:"All_Done",cond:"iteratorEmpty"},{target:"Serving_Agents",actions:"updateContext"}],onError:{target:"Fail",actions:"logError"}}},Serving_Agents:{invoke:{id:"serve_next_agent",src:"serve_next_agent",onDone:[{target:"Serving_Training_Sets",cond:"iteratorEmpty"},{target:"Creating_Agent",actions:"updateContext"}],onError:{target:"Fail",actions:"logError"}}},Creating_Agent:{invoke:{id:"create_agent",src:"create_agent",onDone:{target:"Handling_Prior_Knowledge",actions:"assignAgentId"},onError:{target:"Fail",actions:"logError"}}},Handling_Prior_Knowledge:{invoke:{id:"handle_prior_knowledge",src:"handle_prior_knowledge",onDone:{target:"Serving_Problems",actions:"updateContext"},onError:{target:"Fail",actions:"logError"}}},Serving_Problems:{invoke:{id:"serve_next_problem",src:"serve_next_problem",onDone:[{target:"Serving_Agents",cond:"iteratorEmpty"},{target:"Waiting_Problem_Load",actions:"updateContext"}],onError:{target:"Fail",actions:"logError"}}},Waiting_Problem_Load:{invoke:{id:"load_problem",src:"load_problem",onDone:{target:"Training",actions:"updateContext"},onError:{target:"Fail",actions:"logError"}}},Training:{entry:"start_training_interaction",on:{PROBLEM_DONE:{target:"Serving_Problems",actions:"sendProblemDone"},CHANGE_INTERACTION_MODE:{target:"Serving_Problems",actions:"assignInteractionSM"}}},All_Done:{entry:"allDone",type:"final"},Fail:{entry:["logError","kill_this"]}}},{services:{load_training_file:b,serve_next_training_set:y,serve_next_agent:S,create_agent:n.createAgent,serve_next_problem:A,load_problem:C,handle_prior_knowledge:T},actions:{start_training_interaction:O,logError:function(e,t){console.error(t.data)},updateContext:(0,c.assign)(function(e,t){return t.data.updateContext}),assignAgentId:(0,c.assign)(function(e,t){return{agent_id:t.data.agent_id}}),allDone:L,assignInteractionSM:P,sendProblemDone:I},guards:{iteratorEmpty:w}})},t.problem_props=void 0;var a=r(n(53)),i=r(n(57)),o=r(n(78)),s=r(n(39)),l=r(n(79)),c=n(85),u=r(n(133)),d=n(132),f=n(249),p=n(250),_=n(172),h=n(171),g=(n(334),new _.Random,["agent_id","free_author","interactive","tutor_mode","examples_only","test_mode"]);t.problem_props=g;var m=g.reduce(function(e,t){return e[t]=null,e},{}),v={s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}};function b(e,t){return console.log("TRAINING JSON:",e.training_file),fetch(e.training_file).then(function(e){return e.text()}).then(function(e){return u.default.parse(e)}).then(function(e){return Object.entries(e)}).then(function(e){return{updateContext:{training_iterator:e}}})}function y(e,t){return new Promise(function(){var t=(0,l.default)(o.default.mark(function t(n,r){var a,i,l,c,u;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.training_iterator,i=e.file_params||{},console.log("TRAINING ITERATOR",a.length),!(a.length>0)){t.next=14;break}for(l=a.shift(),c=l[0];"set_params"==c;)i=(0,s.default)({},i,l[1]),l=a.shift(),c=l[0];return console.log("START TRAINING SET: ",c,i),t.next=10,(0,p.evalJSONFunc)(l[1],e);case 10:u=t.sent,n({updateContext:{training_iterator:a,agent_iterator:u,file_params:i,training_description:e.training_file.replace(/^.*[\\\/]/,"")+" : "+c}}),t.next=15;break;case 14:n(null);case 15:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"==typeof e&&(e={type:e}),null!=t&&(e.problem_set=t),e.initialized=!1,{outer_loop_controller:e}}function S(e,t){return new Promise(function(){var t=(0,l.default)(o.default.mark(function t(n,r){var a,l,c,u,d,f,_,h,g;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.agent_iterator,console.log("AGENT ITERATOR",a.length),!(e.agent_iterator.length>0)){t.next=25;break}return"repetitions"in(l=a.shift())&&(l.repetitions<0?a.unshift((0,s.default)({},l,{_rep_count:(l._rep_count||1)+1})):0==l.repetitions?l=a.shift():l.repetitions>=2&&(l.repetitions-=1,a.unshift((0,s.default)({},l,{_rep_count:(l._rep_count||1)+1}))),l._rep_count=l._rep_count||1),t.next=7,(0,p.evalJSONFunc)(l.problem_set,e);case 7:c=t.sent,console.log("RESOLVED PROBLEM SET",(0,i.default)(c)),l=(0,s.default)({},e.file_params.agent||{},l),e.file_params.agent&&e.file_params.agent.args&&(l.args=(0,s.default)({},e.file_params.agent.args,l.args)),u=l.set_params||{},d=null!=l._rep_count?"("+l._rep_count+")":"",l.agent_name+=d,f="Agent Name: "+l.agent_name+"\nAgent Type: "+l.agent_type,_=(0,i.default)(l.prior_knowledge||[]),h=null,"outer_loop_controller"in l&&(h=k(l.outer_loop_controller,c),c=[h]),delete(g=(0,s.default)({},l)).problem_set,delete g.agent_name,delete g.agent_type,n({updateContext:{start_state_history:[],request_history:[],session_id:v.guid(),user_guid:l.agent_name,agent_params:u,agent_name:l.agent_name,agent_type:l.agent_type,agent_description:f,other_agent_data:g,agent_iterator:a,problem_set:c,prior_knowledge:_,agent_start_time:new Date}}),t.next=26;break;case 25:n(null);case 26:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}function T(e,t){var n=new Promise(function(t,r){for(var a=e.prior_knowledge;a.length>0;){console.log("CURRENT",a);var i=a.shift(),o=(0,f.applyPriorKnowledge)(e,i,a);if(o.updateContext&&t({updateContext:o.updateContext}),o.train_now)return n}t({updateContext:{prior_knowledge:a,problem_iterator:e.problem_set}})});return n}function x(e,t,n,r){return E.apply(this,arguments)}function E(){return(E=(0,l.default)(o.default.mark(function e(t,n,r,a){var i;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Promise(function(){var e=(0,l.default)(o.default.mark(function e(i,l){var c,u,d,f,p;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:c=t.shift();case 1:if(!(null!=c&&"outer_loop_controller"in c)){e.next=15;break}if((u=a.network_layer).OUTER_LOOP_URL||u.kill_this("\nCANNOT USE 'outer_loop_controller' : {} pattern unless running train.py with --outer-loop flag.\n"),(d=c.outer_loop_controller).initialized){e.next=9;break}return e.next=8,u.newOuterLoopController(d,a);case 8:d.initialized=!0;case 9:return e.next=11,u.nextProblem(d,a);case 11:null!=(f=e.sent)?(t.unshift((0,s.default)({},c)),c=f):c=t.length>0?t.shift():null,e.next=1;break;case 15:if(c){e.next=18;break}return i([null,n]),e.abrupt("return");case 18:if(!("set_params"in c)){e.next=26;break}if(n=(0,s.default)({},n,c.set_params),c=t.shift()){e.next=24;break}return i([null,n]),e.abrupt("return");case 24:e.next=18;break;case 26:return delete(p=(0,s.default)({},r)).agent,c=(0,s.default)({},p,n,c),i([c,n]),e.abrupt("return");case 31:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),e.abrupt("return",i);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function A(e,t){return new Promise(function(){var t=(0,l.default)(o.default.mark(function t(n,r){var i,l,c,u,d,f,p,_,h;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=null,l=e.agent_params,c=e.file_params,u=e.problem_iterator,e.network_layer,e.interactive,console.log("PROBLEM ITERATOR",u.length),!(u.length>0)){t.next=37;break}return t.next=10,x(u,l,c,e);case 10:if(d=t.sent,f=(0,a.default)(d,2),i=f[0],l=f[1],!i){t.next=34;break}if(!("repetitions"in i)){t.next=30;break}if(!(i.repetitions<0)){t.next=20;break}u.unshift((0,s.default)({},i)),t.next=30;break;case 20:if(0!=i.repetitions){t.next=29;break}return t.next=23,x(u,l,c,e);case 23:p=t.sent,_=(0,a.default)(p,2),i=_[0],l=_[1],t.next=30;break;case 29:i.repetitions>=2&&(i.repetitions-=1,u.unshift((0,s.default)({},i)));case 30:h=Object.keys(i).reduce(function(e,t){return e+t+": "+i[t]+"\n"},""),n({updateContext:{agent_params:l,problem_iterator:u,prob_obj:i,problem_description:h}}),t.next=35;break;case 34:n(null);case 35:t.next=38;break;case 37:n(null);case 38:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}function C(e,t){return e.tutor.loadProblem(e)}function w(e,t){return null==t.data}function I(e,t){e.network_layer.sendProblemDone(e,t)}function O(e,t){console.log("START TRAINING INTERACTION");var n=e.app,r=(0,s.default)({},h(e,g),h(e.prob_obj,g)),a=e.interactions_sm.withContext((0,s.default)({},e.interactions_sm.context,r)),i=(0,c.interpret)(a);e.app.interactions_service=i,i.onTransition(n.onInteractionTransition),i.start()}function L(e,t){var n=e.network_layer;console.log("ITS ALL DONE!"),n.kill_this("\n TRAINING FINISHED SUCCESSFULLY! \n","info")}var P=(0,c.assign)({interactions_sm:function(e,t){var n=(0,s.default)({},{app:e.app},h(e,g),h(e.prob_obj,g),t.data);return console.log("assignInteractionSM",n),(0,d.build_interactions_sm)(n.app,n)}})},249:function(e,t,n){var r=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.applyPriorKnowledge=function(e,t,n){var r=t.type.toLowerCase().replace("_","");return s[r](t,n)};var a=r(n(78)),i=r(n(79)),o=r(n(77)),s={bestintersect:function(e,t,n){return l.apply(this,arguments)}};function l(){return(l=(0,i.default)(a.default.mark(function e(t,n,r){var i,s,l,c;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.cache_folder||t.working_dir+"/.pkcache",s=i+"/"+o.default.basename(t.training_file)+".cache",console.log("MOOOOOOOOO",s),e.next=5,fetch(s).then(function(e){if(!e.ok)throw Error(e.statusText);return e}).then(function(e){return e.text()}).catch(function(e){return null});case 5:return l=e.sent,c=null==l?{updateContext:{prior_knowledge:[n]+r,problem_iterator:[]},train_now:!0}:{updateContext:{prior_knowledge:r,problem_iterator:[]},train_now:!0},e.abrupt("return",c);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}},250:function(e,t,n){var r=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.evalString=function(){return L.apply(this,arguments)},t.evalJSONFunc=P,t.registedFunctions=void 0;var a=r(n(57)),i=r(n(39)),o=r(n(53)),s=r(n(78)),l=r(n(79)),c=n(172),u=r(n(332)),d=r(n(77)),f=new c.Random,p={concatenate:function(e,t){return h.apply(this,arguments)},shuffle:function(e,t){return g.apply(this,arguments)},sample:function(e,t){return m.apply(this,arguments)},glob:function(e,t){return v.apply(this,arguments)},from_file:function(e,t){return b.apply(this,arguments)},estimate_Pik:function(e,t){return C.apply(this,arguments)},gen_pretraining:function(e,t){return w.apply(this,arguments)},gen_pivot_table:function(e,t){return O.apply(this,arguments)},mirror_students:function(e,t){return I.apply(this,arguments)}};function _(e,t){return"/"!=e[0]&&(e=t.working_dir+"/"+e),e}function h(){return(h=(0,l.default)(s.default.mark(function e(t,n){var r,a,i,o,l,c,u,d;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=!0,i=!1,o=void 0,e.prev=4,l=t["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();case 6:if(a=(c=l.next()).done){e.next=15;break}return u=c.value,e.next=10,P(u,n);case 10:d=e.sent,r=r.concat(d);case 12:a=!0,e.next=6;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),i=!0,o=e.t0;case 21:e.prev=21,e.prev=22,a||null==l.return||l.return();case 24:if(e.prev=24,!i){e.next=27;break}throw o;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return e.abrupt("return",r);case 30:case"end":return e.stop()}},e,null,[[4,17,21,29],[22,,24,28]])}))).apply(this,arguments)}function g(){return(g=(0,l.default)(s.default.mark(function e(t,n){var r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(t,n);case 2:return r=e.sent,e.abrupt("return",f.shuffle(r));case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function m(){return(m=(0,l.default)(s.default.mark(function e(t,n){var r,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.n,a=t.set,e.next=4,P(a,n);case 4:return a=e.sent,console.log("IT IS THIS BIG:",a.length),e.abrupt("return",f.sample(a,r));case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function v(){return(v=(0,l.default)(s.default.mark(function e(t,n){var r,a,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"string"==typeof t&&(t={pattern:t}),r=t.key||null,a=t.pattern,e.next=5,n.network_layer.glob(a,n);case 5:return i=e.sent,i=r?i.map(function(e){var t={};return t[r]="/"+e,t}):i.map(function(e){return"/"+e}),e.abrupt("return",i);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function b(){return(b=(0,l.default)(s.default.mark(function e(t,n){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw"Not Implemented";case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function y(e,t){return k.apply(this,arguments)}function k(){return(k=(0,l.default)(s.default.mark(function e(t,n){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))).apply(this,arguments)}function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise(function(){var r=(0,l.default)(s.default.mark(function r(a,i){return s.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t.complete=a,!n){r.next=5;break}return r.next=4,fetch(e).then(function(e){return e.text()});case 4:e=r.sent;case 5:u.default.parse(e,t);case 6:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())}function T(e){return x.apply(this,arguments)}function x(){return(x=(0,l.default)(s.default.mark(function e(t){var n,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={delimiter:"\t",header:!0,dynamicTyping:!0},r=fetch(t).then(function(e){return e.text()}).then(function(e){var t=e.split(/\n{2,}/g);return[t[0].split(/Values for .* model.*\n/)[1],t[1].split("in the selected KC model.\n")[1]]}).then(function(){var e=(0,l.default)(s.default.mark(function e(t){var r,a,i,l,c;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,o.default)(t,2),a=r[0],i=r[1],e.next=3,S(a,n);case 3:return l=e.sent,e.next=6,S(i,n);case 6:return c=e.sent,e.abrupt("return",[l,c]);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",r);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function E(e,t){return A.apply(this,arguments)}function A(){return(A=(0,l.default)(s.default.mark(function e(t,n){var r,a,i,l,c,u,d,f,p,h,g,m,v,b,y,k,x,E,A,C,w,I,O,L,P,F,R,N,M,D,U,H,B,W,j,K,V,q,G;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t.fo_err_by_kc){e.next=28;break}return e.next=3,T(_(t.afm_stats,n));case 3:for(a=e.sent,i=(0,o.default)(a,2),l=i[0],c=i[1],u=c.data.filter(function(e){return e["Anon Student Id"]==t.student_id})[0].Intercept,r={},d=!0,f=!1,p=void 0,e.prev=12,h=l.data["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(d=(g=h.next()).done);d=!0)m=g.value,v=1/(1+Math.exp(u+m["Intercept (logit)"])),r[m["KC Name"]]=v;e.next=20;break;case 16:e.prev=16,e.t0=e.catch(12),f=!0,p=e.t0;case 20:e.prev=20,e.prev=21,d||null==h.return||h.return();case 23:if(e.prev=23,!f){e.next=26;break}throw p;case 26:return e.finish(23);case 27:return e.finish(20);case 28:return r=r||t.fo_err_by_kc,b=_(t.error_table,n),e.next=32,S(b,{delimiter:"\t",header:!0,dynamicTyping:!0},!0);case 32:for(y=e.sent,console.log("error_table"),console.log(y),k={},x=!0,E=!1,A=void 0,e.prev=39,C=y.data["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(x=(w=C.next()).done);x=!0)I=w.value,(O=I["KC Name"])&&(delete I["KC Name"],k[O]=Object.values(I));e.next=47;break;case 43:e.prev=43,e.t1=e.catch(39),E=!0,A=e.t1;case 47:e.prev=47,e.prev=48,x||null==C.return||C.return();case 50:if(e.prev=50,!E){e.next=53;break}throw A;case 53:return e.finish(50);case 54:return e.finish(47);case 55:console.log("curve_by_kc"),console.log(k),L={},e.t2=s.default.keys(k);case 59:if((e.t3=e.t2()).done){e.next=86;break}for(P=e.t3.value,F=k[P],R=1/0,M=r[P],D=!0,U=!1,H=void 0,e.prev=67,B=F.entries()["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(D=(W=B.next()).done);D=!0)j=W.value,K=(0,o.default)(j,2),V=K[0],q=K[1],(G=M-q)<R&&G>0&&(R=G,N=V);e.next=75;break;case 71:e.prev=71,e.t4=e.catch(67),U=!0,H=e.t4;case 75:e.prev=75,e.prev=76,D||null==B.return||B.return();case 78:if(e.prev=78,!U){e.next=81;break}throw H;case 81:return e.finish(78);case 82:return e.finish(75);case 83:L[P]=N,e.next=59;break;case 86:return e.abrupt("return",L);case 87:case"end":return e.stop()}},e,null,[[12,16,20,28],[21,,23,27],[39,43,47,55],[48,,50,54],[67,71,75,83],[76,,78,82]])}))).apply(this,arguments)}function C(){return(C=(0,l.default)(s.default.mark(function e(t,n){var r,a,o,l,c,u,d,f;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("ESTIMATE_PIK"),"exact_align"!=t.method){e.next=7;break}return e.next=4,E(t,n);case 4:r=e.sent,e.next=11;break;case 7:if("backcast"!=t.method){e.next=11;break}return e.next=10,y(t,n);case 10:r=e.sent;case 11:if(console.log(t.KCs),console.log("BEFORE"),console.log((0,i.default)({},r)),!("KCs"in t&&null!=t.KCs)){e.next=36;break}for(a={},o=!0,l=!1,c=void 0,e.prev=19,u=t.KCs["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(o=(d=u.next()).done);o=!0)f=d.value,a[f]=r[f];e.next=27;break;case 23:e.prev=23,e.t0=e.catch(19),l=!0,c=e.t0;case 27:e.prev=27,e.prev=28,o||null==u.return||u.return();case 30:if(e.prev=30,!l){e.next=33;break}throw c;case 33:return e.finish(30);case 34:return e.finish(27);case 35:r=a;case 36:if(console.log("AFTER"),console.log((0,i.default)({},r)),"max"in t&&null!=t.max)for(f in r)r[f]=Math.min(r[f],t.max);return e.abrupt("return",r);case 40:case"end":return e.stop()}},e,null,[[19,23,27,35],[28,,30,34]])}))).apply(this,arguments)}function w(){return(w=(0,l.default)(s.default.mark(function e(t,n){var r,a,o,l,c,u,d,p,_,h,g,m,v,b,y,k,S,T,x,E,A,C,w=arguments;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=w.length>2&&void 0!==w[2]&&w[2],e.next=3,P(t.opportunities,n);case 3:if(a=e.sent,o=t.by_step_id?"step_id":"Selection",l="only_"+o+"s",console.log("opps_by_kc"),console.log(a),a=(0,i.default)({},a),"string"!=typeof t.step_pivot_table){e.next=13;break}alert("NOT IMPLEMENTED"),e.next=16;break;case 13:return e.next=15,P(t.step_pivot_table,n);case 15:c=e.sent;case 16:for(console.log("pivot_table"),console.log(c),u=Object.keys(c),r&&(u=f.shuffle(u)),d=[],console.log("problem_pool"),console.log(u),p=t.onlys_map||null,_=!0,h=!1,g=void 0,e.prev=27,m=u["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(_=(v=m.next()).done);_=!0){for(x in b=v.value,y=!0,k=!1,S=[],T=c[b])a[x]>0?(a[x]-=1,E=T[x][o],E=Array.from(E),p&&(E=E.map(function(e){return p[e]})),1==E.length&&(E=E[0]),S.push(E),k=!0):y=!1;k&&((A={})[t.problem_key]=b,y||(A[l]=S),d.push(A))}e.next=35;break;case 31:e.prev=31,e.t0=e.catch(27),h=!0,g=e.t0;case 35:e.prev=35,e.prev=36,_||null==m.return||m.return();case 38:if(e.prev=38,!h){e.next=41;break}throw g;case 41:return e.finish(38);case 42:return e.finish(35);case 43:return Object.values(a).reduce(function(e,t){return e+t},0)>0&&(C="Insufficient problems in problem_pool to pretrain requested number of steps. Additional problems required for KCs/Steps: "+JSON.stringify(a),n.network_layer.kill_this(C),console.error(C)),console.log("gen_pretraining"),console.log(d),console.log("opps_by_kc"),console.log(a),e.abrupt("return",d);case 49:case"end":return e.stop()}},e,null,[[27,31,35,43],[36,,38,42]])}))).apply(this,arguments)}function I(){return(I=(0,l.default)(s.default.mark(function e(t,n){var r,a,i,o,l,c,f,p,h,g,m,v,b,y,k,T,x,E,A,C,w,I,O,L,F,R,N,M,D,U,H,B,W,j,K,V,q,G,J,z,Y,Q,X;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("MIRROR_START"),r=_(t.human_transactions,n),a=t.human_afm_stats,i=t.pool_agent_error_table,o=t.Pik_method,l=t.problem_key,c=t.kc_model,f=t.KCs,p=t.max,e.next=11,P(t.human_problems,n);case 11:for(h=e.sent,g={},m=!0,v=!1,b=void 0,e.prev=16,y=h["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(m=(k=y.next()).done);m=!0)T=k.value,g[d.default.basename(T).split(".")[0]]=T;e.next=24;break;case 20:e.prev=20,e.t0=e.catch(16),v=!0,b=e.t0;case 24:e.prev=24,e.prev=25,m||null==y.return||y.return();case 27:if(e.prev=27,!v){e.next=30;break}throw b;case 30:return e.finish(27);case 31:return e.finish(24);case 32:if(!("step_pivot_table"in t)){e.next=38;break}return e.next=35,P(t.step_pivot_table,n);case 35:x=e.sent,e.next=45;break;case 38:return e.next=40,P(t.pool_agent_problems,n);case 40:return E=e.sent,x={gen_pivot_table:{transaction_file:t.pool_agent_transactions,problem_pool:E,kc_model:t.kc_model}},e.next=44,P(x,n);case 44:x=e.sent;case 45:return A={},C={dynamicTyping:!0,delimiter:"\t",header:!0,download:!0,step:function(e){if((e=e.data)&&"Anon Student Id"in e){var t=A[e["Anon Student Id"]]||[],n=e["Problem Name"]||"",r=e["Problem View"]||"";if(""!=n){var a=String(n)+"#"+String(r);0==t.length?t=[a]:t.includes(a)||t.push(a)}A[e["Anon Student Id"]]=t}}},w=n.network_layer.HOST_URL+r,console.log("human transactions"),console.log(w),e.next=52,S(w,C,!1);case 52:for(I in e.sent,console.log("BEEE"),console.log(A),A)A[I]=A[I].map(function(e){return e.substring(0,e.lastIndexOf("#"))});console.log("AFFFF"),console.log(A),console.log("human_prob_seq"),console.log(A),e.t1=s.default.keys(A);case 61:if((e.t2=e.t1()).done){e.next=87;break}for(O=e.t2.value,L=A[O],F=[],R=!0,N=!1,M=void 0,e.prev=68,D=L["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(R=(U=D.next()).done);R=!0)H=U.value,(B=g[H])&&((W={})[l]=B,F.push(W));e.next=76;break;case 72:e.prev=72,e.t3=e.catch(68),N=!0,M=e.t3;case 76:e.prev=76,e.prev=77,R||null==D.return||D.return();case 79:if(e.prev=79,!N){e.next=82;break}throw M;case 82:return e.finish(79);case 83:return e.finish(76);case 84:A[O]=F,e.next=61;break;case 87:j=[],"store_opp_table"in t&&(K=[]),console.log("full_paths"),console.log(A),e.t4=s.default.keys(A);case 92:if((e.t5=e.t4()).done){e.next=117;break}if(V=e.t5.value,!((q=A[V]).length>0)){e.next=112;break}return G={estimate_Pik:{method:o,afm_stats:a,student_id:V,error_table:i,KCs:f,max:p}},e.next=99,P(G,n);case 99:if(G=e.sent,"store_opp_table"in t){for(J in(W={})["Anon Student Id"]=V,G)W[J]=G[J];K.push(W)}return z={gen_pretraining:{opportunities:G,step_pivot_table:x,problem_key:l,kc_model:c,onlys_map:t.onlys_map||null}},e.next=104,P(z,n);case 104:z=e.sent,Y={agent_name:V,problem_set:{concatenate:[{set_params:{domain_name:"prior_knowledge"}},z,{set_params:{domain_name:void 0}},q]}},j.push(Y),e.next=115;break;case 112:Q="Will Skip Student "+V+"because did not do any problems.",console.warn(Q),n.network_layer.term_print(Q,"warning");case 115:e.next=92;break;case 117:return"store_opp_table"in t&&(X=u.default.unparse(K,{delimiter:"\t"}),console.log("OUT CSV"),console.log(X)),console.log("out"),console.log(j),e.abrupt("return",j);case 121:case"end":return e.stop()}},e,null,[[16,20,24,32],[25,,27,31],[68,72,76,84],[77,,79,83]])}))).apply(this,arguments)}function O(){return(O=(0,l.default)(s.default.mark(function e(t,n){var r,a,i,o,l,c,f,p,h,g,m,v,b,y,k,T,x,E,A,C,w,I,O,L,F;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("cache"in t)){e.next=24;break}return e.next=3,S(_(t.cache,n));case 3:for(a=e.sent,r={},i=!0,o=!1,l=void 0,e.prev=8,c=a["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(i=(f=c.next()).done);i=!0)p=f.value,r[p["Problem Path"]]=r[p["Problem Path"]]||{},r[p["Problem Path"]][p.KC].step_id=p.step_id.split(","),r[p["Problem Path"]][p.KC].Selection=p.Selection.split(",");e.next=16;break;case 12:e.prev=12,e.t0=e.catch(8),o=!0,l=e.t0;case 16:e.prev=16,e.prev=17,i||null==c.return||c.return();case 19:if(e.prev=19,!o){e.next=22;break}throw l;case 22:return e.finish(19);case 23:return e.finish(16);case 24:if(null!=r){e.next=59;break}return h=_(t.transaction_file,n),e.next=28,P(t.problem_pool,n);case 28:for(g=e.sent,m={},v=!0,b=!1,y=void 0,e.prev=33,k=g["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();!(v=(T=k.next()).done);v=!0)x=T.value,m[d.default.basename(x).split(".")[0]]=x;e.next=41;break;case 37:e.prev=37,e.t1=e.catch(33),b=!0,y=e.t1;case 41:e.prev=41,e.prev=42,v||null==k.return||k.return();case 44:if(e.prev=44,!b){e.next=47;break}throw y;case 47:return e.finish(44);case 48:return e.finish(41);case 49:return E=null!=(E=t.kc_model||null)?"KC ("+E+")":"Step Name",r={},A={dynamicTyping:!0,delimiter:"\t",header:!0,download:!0,step:function(e){if("CORRECT"===(e=e.data).Outcome){var t=m[e["Problem Name"]]||null;if(null!=t){t in r||(r[t]={});var n=e[E];if(n){n in r[t]||(r[t][n]={step_id:new Set,Selection:new Set});var a=r[t][n];a.step_id.add(e["CF (step_id)"]),a.Selection.add(e.Selection)}}}}},C=n.network_layer.HOST_URL+h,e.next=56,S(C,A,!1);case 56:if(e.sent,"cache"in t){for(I in w=[],r)for(L in O=r[I])w.append({"Problem Path":I,KC:L,step_id:O[L].step_id.join(","),Selection:O[L].Selection.join(",")});F=u.default.unparse(w,{delimiter:"\t",header:!0,newline:"\n"}),n.network_layer.write_file(_(t.cache,n),F)}return e.abrupt("return",r);case 59:case"end":return e.stop()}},e,null,[[8,12,16,24],[17,,19,23],[33,37,41,49],[42,,44,48]])}))).apply(this,arguments)}function L(){return(L=(0,l.default)(s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw"Not Implemented";case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function P(e,t){return F.apply(this,arguments)}function F(){return(F=(0,l.default)(s.default.mark(function e(t,n){var r,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t)){e.next=4;break}return e.abrupt("return",(0,a.default)(t));case 4:if("object"!==typeof t){e.next=17;break}if(t=(0,i.default)({},t),r=Object.keys(t)[0],o=t[r],!(r in p)){e.next=14;break}return e.next=11,p[r](o,n);case 11:return e.abrupt("return",e.sent);case 14:return e.abrupt("return",t);case 15:e.next=18;break;case 17:return e.abrupt("return",t);case 18:case"end":return e.stop()}},e)}))).apply(this,arguments)}t.registedFunctions=p},254:function(e,t){},256:function(e,t){},289:function(e,t){},290:function(e,t){},335:function(e,t,n){var r=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(39)),i=r(n(43)),o=r(n(44)),s=r(n(78)),l=r(n(79)),c=r(n(92));function u(e,t){return"matches"==e?void 0:t}function d(e){return f.apply(this,arguments)}function f(){return(f=(0,l.default)(s.default.mark(function e(t){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){setTimeout(e,t)}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var p=function(){var e=(0,l.default)(s.default.mark(function e(t,n){var r,a,i,o,l=arguments;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=l.length>2&&void 0!==l[2]?l[2]:3,a=l.length>3&&void 0!==l[3]?l[3]:100,i=!(l.length>4&&void 0!==l[4])||l[4],o=0;case 4:if(!(o<r)){e.next=23;break}return e.prev=5,e.next=8,fetch(t,n);case 8:return e.abrupt("return",e.sent);case 11:if(e.prev=11,e.t0=e.catch(5),console.log("AL ERROR Retrying",e.t0),!(o+1===r)){e.next=17;break}throw e.t0;case 17:return console.log("waiting",i?a*Math.pow(2,o):a),e.next=20,d(i?a*Math.pow(2,o):a);case 20:o++,e.next=4;break;case 23:case"end":return e.stop()}},e,null,[[5,11]])}));return function(t,n){return e.apply(this,arguments)}}(),_={Accept:"application/json","Content-Type":"application/json"},h=function(){function e(t,n,r){(0,i.default)(this,e),this.AL_URL=t,this.HOST_URL=n,this.OUTER_LOOP_URL=r,this.request_history=[],(0,c.default)(this)}return(0,o.default)(e,[{key:"createAgent",value:function(e,t){var n={name:e.agent_name,agent_type:e.agent_type,project_id:e.project_id};return n=(0,a.default)({},e.other_agent_data,n),console.log(this.AL_URL+"/create/"),this.request_history=[],p(this.AL_URL+"/create/",{method:"POST",headers:_,body:JSON.stringify(n)},6).then(function(e){return e.json()})}},{key:"sendFeedback",value:function(e,t){console.log("sendFeedback"),null===e.staged_SAI&&console.error("cannot give feedback on no action.");var n,r=e.skill_applications,a=e.feedback_map;if(a&&Object.keys(a).length>0){var i=[];for(var o in a){var s=r[o],l={state:e.state,rhs_id:s.rhs_id,mapping:s.mapping,reward:"correct"==a[o].toLowerCase()?1:-1};e.interactive&&(l.add_skill_info=!0),i.push(l)}n=this.sendTrainingData(i,e.agent_id)}else{s=e.staged_SAI,l={state:e.state,selection:s.selection,action:s.action,inputs:s.inputs,foci_of_attention:s.foci_of_attention,rhs_id:s.rhs_id,mapping:s.mapping,reward:s.reward};e.interactive&&(l.add_skill_info=!0),n=this.sendTrainingData(l,e.agent_id)}return n}},{key:"sendTrainingData",value:function(e,t){console.log("sendTrainingData");var n=this.AL_URL+"/train/"+t+"/";return p(n,{method:"POST",headers:_,body:JSON.stringify(e,u)}).then(function(e){return e.text()}).then(function(e){try{return JSON.parse(e)}catch(t){return{}}})}},{key:"queryApprentice",value:function(e,t){console.log("queryApprentice");var n={state:e.state};e.interactive&&(n.kwargs={add_skill_info:!0,n:0}),this.request_history.push(n);var r=this.AL_URL+"/request/"+e.agent_id+"/";return p(r,{method:"POST",headers:_,body:JSON.stringify(n)}).then(function(e){return e.json()})}},{key:"checkApprentice",value:function(e,t){console.log("checkApprentice");var n=(0,a.default)({state:e.state},e.staged_SAI),r=this.AL_URL+"/check/"+e.agent_id+"/";return p(r,{method:"POST",headers:_,body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){return+e.reward})}},{key:"term_print",value:function(e){var t={message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default"};return p(this.HOST_URL,{method:"PRINT",headers:_,body:JSON.stringify(t)})}},{key:"kill_this",value:function(e){var t={message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error"};return p(this.HOST_URL,{method:"QUIT",headers:_,body:JSON.stringify(t)})}},{key:"write_file",value:function(e,t){t={file:e,data:t};return p(this.HOST_URL,{method:"WRITE",headers:_,body:JSON.stringify(t)})}},{key:"sendProblemDone",value:function(e,t){return p(this.HOST_URL,{method:"PROBLEM_DONE",headers:_,body:JSON.stringify({},u)})}},{key:"generate_nools",value:function(e,t){var n=this,r=this.AL_URL+"/get_skills/"+e.agent_id+"/",a={states:this.request_history.map(function(e){return e.state})};return p(r,{method:"POST",headers:_,body:JSON.stringify(a,u)}).then(function(e){return e.json()}).then(function(t){console.log("NOOLS DIR: ",e.nools_dir);var r={nools_dir:e.nools_dir,problems:e.start_state_history,skills:t};return fetch(n.HOST_URL,{method:"GEN_NOOLS",headers:_,body:JSON.stringify(r,u)})})}},{key:"generateBehaviorProfile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.data=t.data||{};var n=t.data.requests||this.request_history,r=t.data.out_dir||(e.working_dir||".")+"/bprofiles",a=this.HOST_URL,i=this.AL_URL,o=(new Date-e.agent_start_time)%864e5%36e5/6e4,c={dir:r,elapse_minutes:o.toFixed(1)};return fetch(a,{method:"START_BEHAVIOR_PROFILE",headers:_,body:JSON.stringify(c)}).then(function(){var t=(0,l.default)(s.default.mark(function t(o){var l,c,u,d,f,h,g,m,v,b,y;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:l=!0,c=!1,u=void 0,t.prev=3,d=n["function"===typeof Symbol&&"function"===typeof Symbol?Symbol.iterator:"@@iterator"]();case 5:if(l=(f=d.next()).done){t.next=20;break}return h=f.value,g=h.state,m={state:g,kwargs:{add_skill_info:!0,n:-1}},t.next=11,p(i+"/request/"+e.agent_id+"/",{method:"POST",headers:_,body:JSON.stringify(m)}).then(function(e){return e.json()});case 11:return v=t.sent,b=[],"responses"in v&&v.responses.forEach(function(e,t){var n={selection:e.selection,action:e.action,inputs:e.inputs};console.log(e),console.log(e.selection),b.push(n)}),y={state:g,responses:b,dir:r},t.next=17,fetch(a,{method:"APPEND_BEHAVIOR_PROFILE",headers:_,body:JSON.stringify(y)});case 17:l=!0,t.next=5;break;case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(3),c=!0,u=t.t0;case 26:t.prev=26,t.prev=27,l||null==d.return||d.return();case 29:if(t.prev=29,!c){t.next=32;break}throw u;case 32:return t.finish(29);case 33:return t.finish(26);case 34:case"end":return t.stop()}},t,null,[[3,22,26,34],[27,,29,33]])}));return function(e){return t.apply(this,arguments)}}())}},{key:"newOuterLoopController",value:function(e,t){var n={outer_loop_type:e.type||e.outer_loop_type,problem_set:e.problem_set,outer_loop_args:e.args||e.outer_loop_args,id:t.agent_id};console.log(this.OUTER_LOOP_URL);var r=fetch(this.OUTER_LOOP_URL,{method:"NEW_STUDENT",headers:_,body:JSON.stringify(n)}).then(function(e){});return console.log(r),r}},{key:"nextProblem",value:function(e,t){var n={id:t.agent_id};return fetch(this.OUTER_LOOP_URL,{method:"NEXT_PROBLEM",headers:_,body:JSON.stringify(n)}).then(function(e){return e.json()})}},{key:"glob",value:function(e,t){return"/"!=e[0]&&(e=t.working_dir+"/"+e),fetch(this.HOST_URL,{method:"GLOB",headers:_,body:JSON.stringify(e)}).then(function(e){return e.json()})}}]),e}();t.default=h}},[[191,1,2]]]);
//# sourceMappingURL=main.258af481.chunk.js.map